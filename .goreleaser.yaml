project_name: cluster-to-redpanda-migration
builds:
  - id: redpanda-operator
    dir: ./src/go/k8s/
    main: ./cmd/main.go
    binary: redpanda-operator-{{ .Os }}-{{ .Arch }}
    no_unique_dist_dir: true
    env:
      - CGO_ENABLED=0
      - GOPRIVATE=github.com/redpanda-data/flux-controller-shim
    goos:
      - linux
      - darwin
    goarch:
      - amd64
      - arm64

  - id: configurator
    dir: ./src/go/k8s/
    main: ./cmd/configurator/main.go
    binary: configurator-{{ .Os }}-{{ .Arch }}
    no_unique_dist_dir: true
    env:
      - CGO_ENABLED=0
      - GOPRIVATE=github.com/redpanda-data/flux-controller-shim
    goos:
      - linux
      - darwin
    goarch:
      - amd64
      - arm64

  - id: migration-tool-windows-and-linux
    dir: ./src/go/cluster-to-redpanda-migration/
    main: ./main.go
    binary: cluster-to-redpanda-migration
    ldflags:
      - -X github.com/redpanda-data/redpanda-operator/src/go/cluster-to-redpanda-migration/cmd/version.version={{.Tag}}
    env:
      - CGO_ENABLED=0
    goos:
      - windows
      - linux
    goarch:
      - amd64
      - arm64

  - id: migration-tool-darwin
    dir: ./src/go/cluster-to-redpanda-migration/
    main: ./main.go
    binary: cluster-to-redpanda-migration
    ldflags:
      - -X github.com/redpanda-data/redpanda-operator/src/go/cluster-to-redpanda-migration/cmd/version.version={{.Tag}}
    env:
      - CGO_ENABLED=0
    goos:
      - darwin
    goarch:
      - amd64
      - arm64
    hooks:
      post:
        - cmd: quill sign-and-notarize "{{ .Path }}" --dry-run={{ .IsSnapshot }} --ad-hoc={{ .IsSnapshot }} -vv
          env:
            - QUILL_LOG_FILE=dist/quill-{{ .Target }}.log
archives:
  - id: migration-tool
    builds:
      - migration-tool-windows-and-linux
      - migration-tool-darwin
    format: zip
    name_template: "cluster-to-redpanda-migration-{{ .Os }}-{{ .Arch }}"
release:
  github:
    owner: redpanda-data
    name: redpanda-operator
  draft: true
  discussion_category_name: Releases
announce:
  skip: "true"
